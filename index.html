<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Palmerston North Clearing Viewer</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>
  <style>
  .legend {
    background: white;
    padding: 10px;
    line-height: 18px;
    color: #333;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
  }
  .legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.9;
  }
  .legend h4 {
    margin: 0 0 5px;
    font-size: 14px;
	
	
  }
    .legend-line {
	  display: inline-block;
	  width: 30px;
	  border-top: 6px solid;
	  margin-right: 8px;
	}
</style>
</head>

<body>
<div id="map" style="height: 100vh;"></div>




<script>

// --- Base map ---
var map = L.map('map').setView([-40.356, 175.615], 15);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

// --- Style for clearing outline ---
var clearingStyle = {
  color: "#ff6600",
  weight:8,
  fillOpacity: 0
};

// --- Highlight style ---
var highlightStyle = {
  color: "#00ffff",
  weight: 8,
  fillOpacity: 0.4
};

var activeHighlight;

// --- Load clearing outline ---


// --- Function to handle click highlight ---
function onFeatureClick(e) {
  if (activeHighlight) {
    map.removeLayer(activeHighlight);
  }
  activeHighlight = L.geoJSON(e.target.feature, { style: highlightStyle }).addTo(map);
}

// --- Load intersection layers ---
// --- Load clearing outline ---
var clearingLayer = new L.GeoJSON.AJAX("clearing_outline.geojson", {
  style: clearingStyle
});



clearingLayer.addTo(map);

// --- Load intersection layers ---
var roadsLayer = new L.GeoJSON.AJAX("clearing_intersect_roads.geojson", {
  onEachFeature: function (feature, layer) {
    layer.on("click", onFeatureClick);
  },
  style: { color: "#4444ff", weight: 6 }
});

var parksLayer = new L.GeoJSON.AJAX("clearing_intersect_parks.geojson", {
  onEachFeature: function (feature, layer) {
    layer.on("click", onFeatureClick);
  },
  style: { color: "#44aa44", weight: 6 }
});

// Residential + Commercial (your landuse split)
var residentialLayer = new L.GeoJSON.AJAX("clearing_intersect_residential.geojson", {
  onEachFeature: function (feature, layer) {
    layer.on("click", onFeatureClick);
  },
  style: { color: "#ffaa00", weight: 6 }
});

var commercialLayer = new L.GeoJSON.AJAX("clearing_intersect_commerical.geojson", {
  onEachFeature: function (feature, layer) {
    layer.on("click", onFeatureClick);
  },
  style: { color: "#aa00ff", weight: 6 }
});

var schoolsLayer = new L.GeoJSON.AJAX("clearing_intersect_schools.geojson", {
  onEachFeature: function (feature, layer) {
    layer.on("click", onFeatureClick);
  },
  style: { color: "#00aa88", weight: 6 }
});


// --- Layer controls ---
L.control.layers(
  null,
  {
    "Roads": roadsLayer,
    "Parks": parksLayer,
    "Residential": residentialLayer,
    "Commercial": commercialLayer,
    "Schools": schoolsLayer
  }
).addTo(map);

// --- Legend Control ---
var legend = L.control({ position: "bottomright" });

legend.onAdd = function (map) {
  var div = L.DomUtil.create("div", "info legend");

  div.innerHTML += "<h4>Legend</h4>";

  div.innerHTML += `
    <label><input type="checkbox" id="roadsCheck">
      <span class="legend-line" style="border-color:#4444ff"></span> Roads
    </label><br>

    <label><input type="checkbox" id="parksCheck">
      <span class="legend-line" style="border-color:#44aa44"></span> Parks
    </label><br>

    <label><input type="checkbox" id="resCheck">
      <span class="legend-line" style="border-color:#ffaa00"></span> Residential
    </label><br>

    <label><input type="checkbox" id="comCheck">
      <span class="legend-line" style="border-color:#aa00ff"></span> Commercial
    </label><br>

    <label><input type="checkbox" id="schoolsCheck">
      <span class="legend-line" style="border-color:#00aa88"></span> Schools
    </label><br>
  `;

  return div;
};

legend.addTo(map);
</script>   <!-- CLOSE the main script block -->

<script>
// Checkbox event listeners
document.getElementById("roadsCheck").addEventListener("change", function(e) {
  e.target.checked ? map.addLayer(roadsLayer) : map.removeLayer(roadsLayer);
});

document.getElementById("parksCheck").addEventListener("change", function(e) {
  e.target.checked ? map.addLayer(parksLayer) : map.removeLayer(parksLayer);
});

document.getElementById("resCheck").addEventListener("change", function(e) {
  e.target.checked ? map.addLayer(residentialLayer) : map.removeLayer(residentialLayer);
});

document.getElementById("comCheck").addEventListener("change", function(e) {
  e.target.checked ? map.addLayer(commercialLayer) : map.removeLayer(commercialLayer);
});

document.getElementById("schoolsCheck").addEventListener("change", function(e) {
  e.target.checked ? map.addLayer(schoolsLayer) : map.removeLayer(schoolsLayer);
});
</script>
</body>
</html>